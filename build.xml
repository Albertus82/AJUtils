<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project>
<project name="JFaceUtils" default="all">

	<property environment="env" />
	<property name="env.JRE6_HOME" value="${env.JAVA_HOME}/../jdk1.6.0_45/jre" />

	<property file="build.properties" />
	<property file="${build.resourcesDirectory}/version.properties" />

	<target name="clean">
		<delete dir="${build.directory}" />
	</target>

	<target name="compile">
		<mkdir dir="${build.outputDirectory}" />
		<javac srcdir="${build.sourceDirectory}" destdir="${build.outputDirectory}" source="${build.compiler.source}" target="${build.compiler.target}" debug="true" includeantruntime="false">
			<classpath>
				<fileset dir="${dependencies.directory}">
					<include name="provided/*.jar" />
				</fileset>
			</classpath>
			<bootclasspath path="${build.compiler.compilerArguments.bootclasspath}" />
		</javac>
	</target>

	<target name="resources">
		<copy todir="${build.outputDirectory}">
			<fileset dir="${build.resourcesDirectory}" />
		</copy>
	</target>

	<target name="dist" depends="compile, resources">
		<fileset id="docs" dir="">
			<include name="README*" />
			<include name="LICENSE*" />
			<include name="NOTICE*" />
		</fileset>

		<jar destfile="${build.distDirectory}/${artifactId}-${version.number}.jar" basedir="${build.outputDirectory}" level="9">
			<metainf refid="docs" />
			<manifest>
				<attribute name="Implementation-Title" value="${name}" />
				<attribute name="Implementation-Version" value="${version.number}" />
				<attribute name="X-Compile-Source-JDK" value="${build.compiler.source}" />
				<attribute name="X-Compile-Target-JDK" value="${build.compiler.target}" />
			</manifest>
		</jar>
		<jar destfile="${build.distDirectory}/${artifactId}-${version.number}-sources.jar" basedir="${build.sourceDirectory}" level="9" includes="**/*.java">
			<metainf refid="docs" />
			<manifest>
				<attribute name="Implementation-Title" value="${name}" />
				<attribute name="Implementation-Version" value="${version.number}" />
				<attribute name="X-Compile-Source-JDK" value="${build.compiler.source}" />
				<attribute name="X-Compile-Target-JDK" value="${build.compiler.target}" />
			</manifest>
			<fileset dir="${build.resourcesDirectory}" />
		</jar>
	</target>

	<available file="${build.testSourceDirectory}" type="dir" property="build.test" />

	<target name="test" depends="dist" if="build.test">
		<mkdir dir="${build.outputTestDirectory}" />
		<javac srcdir="${build.testSourceDirectory}" destdir="${build.outputTestDirectory}" source="${build.compiler.source}" target="${build.compiler.target}" debug="true" includeantruntime="false">
			<classpath path="${build.outputDirectory}">
				<fileset dir="${dependencies.directory}">
					<include name="provided/*.jar" />
					<include name="test/*.jar" />
				</fileset>
			</classpath>
			<bootclasspath path="${build.compiler.compilerArguments.bootclasspath}" />
		</javac>

		<junit printsummary="yes" haltonfailure="yes">
			<classpath path="${build.outputTestDirectory}">
				<fileset dir="${build.distDirectory}">
					<include name="${artifactId}-${version.number}.jar" />
				</fileset>
				<fileset dir="${dependencies.directory}">
					<include name="test/*.jar" />
				</fileset>
			</classpath>
			<batchtest>
				<fileset dir="${build.outputTestDirectory}">
					<include name="**/*Test*" />
				</fileset>
			</batchtest>
			<formatter type="plain" usefile="false" />
		</junit>
	</target>

	<target name="sonar-main">
		<echo file="sonar-project.properties">
			sonar.projectKey=it.albertus:${artifactId}
			sonar.projectName=${name}
			sonar.projectVersion=${version.number}
			sonar.sources=${build.sourceDirectory}
			sonar.language=java
			sonar.java.source=${build.compiler.source}
			sonar.java.target=${build.compiler.target}
			sonar.java.libraries=${dependencies.directory}/provided/*.jar
			sonar.java.binaries=${build.outputDirectory}
			sonar.sourceEncoding=UTF-8
		</echo>
	</target>

	<target name="sonar-test" depends="sonar-main" if="build.test">
		<echo file="sonar-project.properties" append="true">
			sonar.tests=${build.testSourceDirectory}
			sonar.java.test.libraries=${dependencies.directory}/provided/*.jar,${dependencies.directory}/test/*.jar,${build.distDirectory}/${artifactId}-${version.number}.jar
			sonar.java.test.binaries=${build.outputTestDirectory}
		</echo>
	</target>

	<target name="sonar" depends="sonar-main, sonar-test">
		<echoproperties srcfile="sonar-project.properties" />
	</target>

	<target name="all" depends="clean, dist, test, sonar" />

</project>
